function createGame2048(p){var u=(p=p||4)*p,s=0,m=Array.apply(null,{length:p}).map(function(){return Array.apply(null,{length:p}).map(function(){return 0})});function d(n){return 0==m[n.y][n.x]}function M(n,r){return m[n.y][n.x]==m[r.y][r.x]}function n(n,r,t){n.x=r,n.y=t}function r(n,r,t){n.x=t,n.y=r}function t(n,r,t){n.x=p-1-r,n.y=t}function o(n,r,t){n.x=t,n.y=p-1-r}function f(n){for(var r,t,u,o,f=0,y=[],a=[],e={},i={},x=0;x<p;x++)for(var c=p,l=p-2;0<=l;l--)if(n(e,l,x),!d(e)){for(var v=l;v+1<c;){if(n(i,v+1,x),!d(i)){M(e,i)&&(c=++v);break}v++}if(l!=v){n(i,v,x);var h=(r=e,0,u=d(t=i),o=m[t.y][t.x]+=m[r.y][r.x],m[r.y][r.x]=0,u?0:o);y.push({from:{x:e.x,y:e.y},to:{x:i.x,y:i.y}}),0<h&&(a.push({x:i.x,y:i.y,value:h}),f+=h,s+=h)}}return{moves:y,consolidations:a,scoreInc:f}}return{size:p,board:m,score:function(){return s},turn:function(){var n=[],r=function(){for(var n=Math.floor(Math.random()*u),r={},t=u;0<t;t--){if(r.y=Math.floor(n/p),r.x=n%p,d(r))return r;++n==u&&(n=0)}return null}();if(null!=r){var t=.8<Math.random()?4:2;r.value=t,m[r.y][r.x]=t,n.push(r)}return n},right:function(){return f(n)},down:function(){return f(r)},left:function(){return f(t)},up:function(){return f(o)},canMove:function(){for(var n={y:0},r={y:0},t={y:1};n.y<p;n.y++,r.y++,t.y++)for(n.x=0,r.x=1,t.x=0;n.x<p;n.x++,r.x++,t.x++)if(d(n)||r.x<p&&M(n,r)||t.y<p&&M(n,t))return!0}}}